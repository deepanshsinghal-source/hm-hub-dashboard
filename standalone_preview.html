<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hub Summary Designer Revamp - Preview</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        border: "hsl(214.3 31.8% 91.4%)",
                        input: "hsl(214.3 31.8% 91.4%)",
                        ring: "hsl(222.2 84% 4.9%)",
                        background: "hsl(0 0% 100%)",
                        foreground: "hsl(222.2 84% 4.9%)",
                        primary: {
                            DEFAULT: "hsl(222.2 47.4% 11.2%)",
                            foreground: "hsl(210 40% 98%)",
                        },
                        secondary: {
                            DEFAULT: "hsl(210 40% 96.1%)",
                            foreground: "hsl(222.2 47.4% 11.2%)",
                        },
                        destructive: {
                            DEFAULT: "hsl(0 84.2% 60.2%)",
                            foreground: "hsl(210 40% 98%)",
                        },
                        muted: {
                            DEFAULT: "hsl(210 40% 96.1%)",
                            foreground: "hsl(215.4 16.3% 46.9%)",
                        },
                        accent: {
                            DEFAULT: "hsl(210 40% 96.1%)",
                            foreground: "hsl(222.2 47.4% 11.2%)",
                        },
                        popover: {
                            DEFAULT: "hsl(0 0% 100%)",
                            foreground: "hsl(222.2 84% 4.9%)",
                        },
                        card: {
                            DEFAULT: "hsl(0 0% 100%)",
                            foreground: "hsl(222.2 84% 4.9%)",
                        },
                    },
                    borderRadius: {
                        lg: "0.5rem",
                        md: "calc(0.5rem - 2px)",
                        sm: "calc(0.5rem - 4px)",
                    },
                },
            },
        }
    </script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lucide Icons (We will use inline SVGs instead, to avoid dependency issues in standalone) -->
</head>

<body class="bg-slate-50 min-h-screen">
    <div id="root"></div>

    <script type="text/babel" data-presets="react,typescript">
        const { useState, useMemo, useEffect } = React;

        // --- UTILS ---
        function cn(...classes) {
            return classes.filter(Boolean).join(" ");
        }
        const cx = cn;

        // --- ICONS (Inline SVGs) ---
        const MapPin = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" /><circle cx="12" cy="10" r="3" /></svg>
        );
        const CalendarDays = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="18" x="3" y="4" rx="2" ry="2" /><line x1="16" x2="16" y1="2" y2="6" /><line x1="8" x2="8" y1="2" y2="6" /><line x1="3" x2="21" y1="10" y2="10" /><path d="M8 14h.01" /><path d="M12 14h.01" /><path d="M16 14h.01" /><path d="M8 18h.01" /><path d="M12 18h.01" /><path d="M16 18h.01" /></svg>
        );
        const Star = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" /></svg>
        );
        const ChevronDown = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m6 9 6 6 6-6" /></svg>
        );
        const ChevronUp = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m18 15-6-6-6 6" /></svg>
        );

        // --- UI COMPONENTS ---
        const Card = ({ className, children, ...props }) => (
            <div className={cn("rounded-lg border bg-card text-card-foreground shadow-sm", className)} {...props}>{children}</div>
        );
        const CardHeader = ({ className, children, ...props }) => (
            <div className={cn("flex flex-col space-y-1.5 p-6", className)} {...props}>{children}</div>
        );
        const CardTitle = ({ className, children, ...props }) => (
            <h3 className={cn("text-2xl font-semibold leading-none tracking-tight", className)} {...props}>{children}</h3>
        );
        const CardContent = ({ className, children, ...props }) => (
            <div className={cn("p-6 pt-0", className)} {...props}>{children}</div>
        );
        const Badge = ({ className, ...props }) => (
            <div className={cn("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-primary text-primary-foreground hover:bg-primary/80", className)} {...props} />
        );
        const Input = ({ className, type, ...props }) => (
            <input type={type} className={cn("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50", className)} {...props} />
        );
        const Separator = ({ className, orientation = "horizontal", ...props }) => (
            <div className={cn("shrink-0 bg-border", orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]", className)} {...props} />
        );

        // --- MAIN LOGIC & COMPONENT (Adapted from TSX) ---

        // Types are stripped for JS execution but logic remains.

        function pad2(n) {
            return String(n).padStart(2, "0");
        }

        function statusLabel(s) {
            return s.charAt(0) + s.slice(1).toLowerCase();
        }

        function parseISODate(iso) {
            const [y, m, d] = iso.split("-").map((x) => Number(x));
            return new Date(y, (m || 1) - 1, d || 1);
        }

        function formatISODate(d) {
            return `${d.getFullYear()}-${pad2(d.getMonth() + 1)}-${pad2(d.getDate())}`;
        }

        function addDaysISO(iso, deltaDays) {
            const d = parseISODate(iso);
            d.setDate(d.getDate() + deltaDays);
            return formatISODate(d);
        }

        function getRangeStartISO(endISO, range, customStartISO) {
            if (range === "CUSTOM") return customStartISO || endISO;
            if (range === "1D") return endISO;
            if (range === "2D") return addDaysISO(endISO, -1);
            return addDaysISO(endISO, -6);
        }

        function inISOInclusiveRange(dISO, startISO, endISO) {
            return dISO >= startISO && dISO <= endISO;
        }

        function ensureLeadId(leadId, index) {
            const raw = String(leadId ?? "").trim();
            return raw ? raw : `LD-${10000 + index}`;
        }

        function generateVisits(baseDateISO) {
            const d0 = baseDateISO;
            const d1 = addDaysISO(baseDateISO, -1);
            const d2 = addDaysISO(baseDateISO, -2);
            const d3 = addDaysISO(baseDateISO, -3);
            const d5 = addDaysISO(baseDateISO, -5);
            const d6 = addDaysISO(baseDateISO, -6);

            return [
                // ===== TODAY =====
                { leadId: "LD-10021", id: "1", type: "HV", dateISO: d0, time: "10:15", customer: "Amit K.", car: "Swift", rm: "Aman", status: "COMPLETED", feedbackRating: 4, feedbackText: "Good experience" },
                { leadId: "LD-10022", id: "2", type: "HV", dateISO: d0, time: "11:05", customer: "Sandeep R.", car: "Baleno", rm: "Aman", status: "COMPLETED", feedbackRating: 5, feedbackText: "Excellent support" },
                { leadId: "LD-10024", id: "2b", type: "HTD", dateISO: d0, time: "12:10", customer: "Varun T.", car: "Verna", rm: "Neha", status: "COMPLETED", feedbackRating: 3, feedbackText: "Average coordination" },
                { leadId: "LD-10025", id: "2c", type: "HV", dateISO: d0, time: "13:00", customer: "Pooja M.", car: "i10", rm: "Rohit", status: "COMPLETED" }, // NF
                { leadId: "LD-10052", id: "3", type: "HV", dateISO: d0, time: "14:10", customer: "Rahul P.", car: "Creta", rm: "Rohit", status: "ONGOING" },
                { leadId: "LD-10036", id: "4", type: "HTD", dateISO: d0, time: "15:00", customer: "Ritika M.", car: "City", status: "SCHEDULED" },
                { leadId: "LD-10040", id: "4b", type: "HV", dateISO: d0, time: "16:20", customer: "Vivek S.", car: "Brezza", status: "CANCELLED" },
                // ===== YESTERDAY =====
                { leadId: "LD-10023", id: "5", type: "HV", dateISO: d1, time: "12:30", customer: "Nikhil P.", car: "i20", rm: "Aman", status: "COMPLETED", feedbackRating: 2, feedbackText: "Delay in arrival" },
                { leadId: "LD-10034", id: "6", type: "HTD", dateISO: d1, time: "12:40", customer: "Diya S.", car: "i20", rm: "Neha", status: "COMPLETED" }, // NF
                { leadId: "LD-10041", id: "6b", type: "HV", dateISO: d1, time: "14:00", customer: "Manish G.", car: "Kushaq", rm: "Sahil", status: "COMPLETED", feedbackRating: 5, feedbackText: "Very professional" },
                // ===== 2 DAYS AGO =====
                { leadId: "LD-10042", id: "7", type: "HV", dateISO: d2, time: "10:45", customer: "Rhea S.", car: "Amaze", rm: "Priya", status: "COMPLETED", feedbackRating: 4, feedbackText: "Smooth process" },
                { leadId: "LD-10043", id: "8", type: "HTD", dateISO: d2, time: "15:15", customer: "Arpit N.", car: "Venue", rm: "Aman", status: "COMPLETED", feedbackRating: 1, feedbackText: "Unhappy with demo" },
                // ===== 3 DAYS AGO =====
                { leadId: "LD-10088", id: "9", type: "HV", dateISO: d3, time: "11:20", customer: "Arjun B.", car: "Scorpio", rm: "Sahil", status: "COMPLETED", feedbackRating: 3, feedbackText: "Decent visit" },
                { leadId: "LD-10089", id: "10", type: "HTD", dateISO: d3, time: "16:10", customer: "Megha L.", car: "Amaze", rm: "Priya", status: "COMPLETED", feedbackRating: 1, feedbackText: "Not satisfied" },
                { leadId: "LD-10044", id: "10b", type: "HV", dateISO: d3, time: "17:30", customer: "Saurabh D.", car: "Harrier", rm: "Neha", status: "COMPLETED", feedbackRating: 4, feedbackText: "Good explanation" },
                // ===== 5 DAYS AGO =====
                { leadId: "LD-10045", id: "11", type: "HV", dateISO: d5, time: "09:50", customer: "Kriti A.", car: "Ertiga", rm: "Rohit", status: "COMPLETED", feedbackRating: 5, feedbackText: "Fantastic service" },
                { leadId: "LD-10046", id: "12", type: "HTD", dateISO: d5, time: "13:40", customer: "Aditya V.", car: "Altroz", rm: "Sahil", status: "COMPLETED" }, // NF
                // ===== 6 DAYS AGO =====
                { leadId: "LD-10090", id: "13", type: "HV", dateISO: d6, time: "10:40", customer: "Kunal R.", car: "Creta", rm: "Neha", status: "COMPLETED", feedbackRating: 4, feedbackText: "Smooth" },
                { leadId: "LD-10091", id: "14", type: "HTD", dateISO: d6, time: "13:00", customer: "Deepak S.", car: "Fortuner", rm: "Priya", status: "COMPLETED" }, // NF
            ];
        }

        function HubSummaryDesignerRevamp() {
            const todayISO = useMemo(() => {
                const d = new Date();
                return `${d.getFullYear()}-${pad2(d.getMonth() + 1)}-${pad2(d.getDate())}`;
            }, []);

            const [dateISO, setDateISO] = useState(todayISO);
            const [scope, setScope] = useState("ALL");

            const [focusStatus, setFocusStatus] = useState("ALL");
            const [visitsOpen, setVisitsOpen] = useState(true);

            const [rangeKey, setRangeKey] = useState("1D");
            const [customStartISO, setCustomStartISO] = useState(todayISO);

            const [feedbackView, setFeedbackView] = useState("HUB");
            const [focusRating, setFocusRating] = useState("ALL");

            const visitsRaw = useMemo(() => generateVisits(dateISO), [dateISO]);

            const visits = useMemo(() => {
                return visitsRaw.map((v, i) => ({ ...v, leadId: ensureLeadId(v.leadId, i) }));
            }, [visitsRaw]);

            const scoped = useMemo(() => {
                if (scope === "ALL") return visits;
                return visits.filter((v) => v.type === scope);
            }, [scope, visits]);

            const counts = useMemo(() => {
                return {
                    total: scoped.length,
                    completed: scoped.filter((v) => v.status === "COMPLETED").length,
                    ongoing: scoped.filter((v) => v.status === "ONGOING").length,
                    scheduled: scoped.filter((v) => v.status === "SCHEDULED").length,
                    cancelled: scoped.filter((v) => v.status === "CANCELLED").length,
                };
            }, [scoped]);

            const visibleVisits = useMemo(() => {
                const list = focusStatus === "ALL" ? scoped : scoped.filter((v) => v.status === focusStatus);
                // show in time order
                return list.slice().sort((a, b) => (a.time + a.id).localeCompare(b.time + b.id));
            }, [scoped, focusStatus]);

            const rangeStartISO = useMemo(
                () => getRangeStartISO(dateISO, rangeKey, customStartISO),
                [dateISO, rangeKey, customStartISO]
            );

            const completedInRange = useMemo(() => {
                return scoped.filter(
                    (v) => v.status === "COMPLETED" && inISOInclusiveRange(v.dateISO, rangeStartISO, dateISO)
                );
            }, [scoped, rangeStartISO, dateISO]);

            const ratingCounts = useMemo(() => {
                const out = { "5": 0, "4": 0, "3": 0, "2": 0, "1": 0, NF: 0 };
                completedInRange.forEach((v) => {
                    if (typeof v.feedbackRating === "number") out[String(v.feedbackRating)]++;
                    else out.NF++;
                });
                return out;
            }, [completedInRange]);

            const visibleFeedback = useMemo(() => {
                if (focusRating === "ALL") return completedInRange;
                if (focusRating === "NF") return completedInRange.filter((v) => !v.feedbackRating);
                return completedInRange.filter((v) => v.feedbackRating === focusRating);
            }, [completedInRange, focusRating]);

            const rmAggregated = useMemo(() => {
                const map = {};

                completedInRange.forEach((v) => {
                    const rmName = v.rm || "Unassigned";
                    if (!map[rmName]) map[rmName] = { total: 0, below3: 0, aboveEq3: 0, nf: 0 };

                    map[rmName].total += 1;
                    if (typeof v.feedbackRating === "number") {
                        if (v.feedbackRating < 3) map[rmName].below3 += 1;
                        else map[rmName].aboveEq3 += 1;
                    } else {
                        map[rmName].nf += 1;
                    }
                });

                return Object.entries(map)
                    .map(([rm, d]) => ({ rm, ...d }))
                    .sort((a, b) => b.total - a.total);
            }, [completedInRange]);

            return (
                <div className="min-h-screen bg-slate-50 pb-20">
                    {/* Header */}
                    <div className="sticky top-0 z-40 border-b bg-white">
                        <div className="mx-auto flex max-w-6xl items-center justify-between px-4 py-4">
                            <div>
                                <CardTitle className="text-lg">Hub Manager Daily Snapshot</CardTitle>
                                <p className="text-xs text-slate-600">One glance → track visits + spot feedback risks</p>
                            </div>

                            <div className="flex items-center gap-2">
                                <MapPin className="h-4 w-4" />
                                <CalendarDays className="h-4 w-4" />
                                <Input
                                    type="date"
                                    value={dateISO}
                                    onChange={(e) => {
                                        setDateISO(e.target.value);
                                        setCustomStartISO(e.target.value);
                                    }}
                                    className="w-[160px]"
                                />
                            </div>
                        </div>
                    </div>

                    <div className="mx-auto max-w-6xl px-4 py-6 space-y-6">
                        <Card className="rounded-2xl">
                            <CardHeader>
                                {/* Scope */}
                                <div className="flex gap-2">
                                    {["ALL", "HV", "HTD"].map((t) => (
                                        <button
                                            key={t}
                                            type="button"
                                            onClick={() => setScope(t)}
                                            className={cx(
                                                "px-4 py-2 rounded-xl border text-sm font-semibold",
                                                scope === t ? "bg-slate-900 text-white" : "bg-white hover:bg-slate-50"
                                            )}
                                        >
                                            {t}
                                        </button>
                                    ))}
                                </div>
                            </CardHeader>

                            <CardContent>
                                {/* KPI Row */}
                                <div className="grid grid-cols-5 gap-3">
                                    {[
                                        { key: "ALL", label: "Total", value: counts.total, collapsible: true },
                                        { key: "COMPLETED", label: "Completed", value: counts.completed },
                                        { key: "ONGOING", label: "Ongoing", value: counts.ongoing },
                                        { key: "SCHEDULED", label: "Scheduled", value: counts.scheduled },
                                        { key: "CANCELLED", label: "Cancelled", value: counts.cancelled },
                                    ].map((k) => (
                                        <button
                                            key={k.key}
                                            type="button"
                                            onClick={() => {
                                                if (k.collapsible) {
                                                    setVisitsOpen((v) => !v);
                                                    setFocusStatus("ALL");
                                                } else {
                                                    setFocusStatus(k.key);
                                                    setVisitsOpen(true);
                                                }
                                            }}
                                            className={cx(
                                                "rounded-xl border p-3 text-left transition",
                                                focusStatus === k.key ? "border-slate-900 bg-slate-50" : "bg-white hover:bg-slate-50"
                                            )}
                                        >
                                            <p className="text-xs text-slate-600 font-semibold">{k.label}</p>
                                            <div className="flex items-center justify-between">
                                                <p className="text-2xl font-bold text-slate-900">{k.value}</p>
                                                {k.collapsible && (
                                                    <span className="text-slate-600">
                                                        {visitsOpen ? <ChevronUp className="h-4 w-4" /> : <ChevronDown className="h-4 w-4" />}
                                                    </span>
                                                )}
                                            </div>
                                        </button>
                                    ))}
                                </div>

                                <Separator className="my-6" />

                                {/* Main Layout */}
                                <div className="grid md:grid-cols-3 gap-6">
                                    {/* Left: Visits Timeline */}
                                    <div className="md:col-span-2">
                                        <div className="flex items-center justify-between">
                                            <p className="text-sm font-semibold text-slate-900">Today’s Visits</p>
                                            {focusStatus !== "ALL" && (
                                                <button
                                                    type="button"
                                                    onClick={() => setFocusStatus("ALL")}
                                                    className="text-xs font-semibold text-slate-600 hover:underline"
                                                >
                                                    Clear filter
                                                </button>
                                            )}
                                        </div>

                                        {visitsOpen ? (
                                            <div className="mt-3 space-y-2 max-h-[520px] overflow-y-auto pr-1">
                                                {visibleVisits.slice(0, 20).map((v) => (
                                                    <div key={v.id} className="rounded-xl border bg-white p-3 flex items-start justify-between">
                                                        <div className="min-w-0">
                                                            <p className="text-sm font-semibold text-slate-900 truncate">
                                                                {v.time} · {v.customer}
                                                            </p>
                                                            <p className="text-xs text-slate-600 truncate">
                                                                Lead: <span className="font-semibold">{v.leadId}</span> · {v.car}
                                                                {v.rm ? (
                                                                    <> · RM {v.rm}</>
                                                                ) : v.status === "SCHEDULED" ? (
                                                                    <> · <span className="text-slate-500">RM Pending</span></>
                                                                ) : null}
                                                            </p>
                                                        </div>
                                                        <Badge className="rounded-xl bg-slate-900 text-white">{statusLabel(v.status)}</Badge>
                                                    </div>
                                                ))}

                                                {visibleVisits.length > 20 && (
                                                    <div className="text-[11px] text-slate-500 px-1">
                                                        Showing first 20 of {visibleVisits.length} visits — scroll to see more.
                                                    </div>
                                                )}

                                                {!visibleVisits.length && (
                                                    <div className="rounded-xl border border-dashed bg-white p-4 text-sm text-slate-600">
                                                        No visits in this view.
                                                    </div>
                                                )}
                                            </div>
                                        ) : (
                                            <div className="mt-3 rounded-xl border border-dashed bg-white p-4 text-sm text-slate-600">
                                                Visits collapsed.
                                            </div>
                                        )}
                                    </div>

                                    {/* Right: Feedback Radar */}
                                    <div>
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-2">
                                                <p className="text-sm font-semibold text-slate-900">Feedback Radar</p>
                                                <div className="flex gap-1">
                                                    <button
                                                        type="button"
                                                        onClick={() => setFeedbackView("HUB")}
                                                        className={cx(
                                                            "px-2 py-1 rounded-lg border text-[11px] font-semibold",
                                                            feedbackView === "HUB" ? "border-slate-900 bg-slate-50" : "bg-white hover:bg-slate-50"
                                                        )}
                                                    >
                                                        Hub
                                                    </button>
                                                    <button
                                                        type="button"
                                                        onClick={() => setFeedbackView("RM")}
                                                        className={cx(
                                                            "px-2 py-1 rounded-lg border text-[11px] font-semibold",
                                                            feedbackView === "RM" ? "border-slate-900 bg-slate-50" : "bg-white hover:bg-slate-50"
                                                        )}
                                                    >
                                                        RM
                                                    </button>
                                                </div>
                                            </div>

                                            {feedbackView === "HUB" && focusRating !== "ALL" && (
                                                <button
                                                    type="button"
                                                    onClick={() => setFocusRating("ALL")}
                                                    className="text-xs font-semibold text-slate-600 hover:underline"
                                                >
                                                    Clear
                                                </button>
                                            )}
                                        </div>

                                        {/* Date Range */}
                                        <div className="mt-3 flex flex-wrap gap-2">
                                            {[
                                                { key: "1D", label: "1 Day" },
                                                { key: "2D", label: "Past 2 Days" },
                                                { key: "7D", label: "Past 7 Days" },
                                            ].map((opt) => (
                                                <button
                                                    key={opt.key}
                                                    type="button"
                                                    onClick={() => setRangeKey(opt.key)}
                                                    className={cx(
                                                        "rounded-xl border px-3 py-1 text-xs font-semibold",
                                                        rangeKey === opt.key ? "border-slate-900 bg-slate-50" : "bg-white hover:bg-slate-50"
                                                    )}
                                                >
                                                    {opt.label}
                                                </button>
                                            ))}

                                            <button
                                                type="button"
                                                onClick={() => setRangeKey("CUSTOM")}
                                                className={cx(
                                                    "rounded-xl border px-3 py-1 text-xs font-semibold",
                                                    rangeKey === "CUSTOM" ? "border-slate-900 bg-slate-50" : "bg-white hover:bg-slate-50"
                                                )}
                                            >
                                                Custom
                                            </button>

                                            <Input
                                                type="date"
                                                value={customStartISO}
                                                onChange={(e) => {
                                                    setCustomStartISO(e.target.value);
                                                    setRangeKey("CUSTOM");
                                                }}
                                                className="w-[140px] rounded-xl text-xs"
                                                title="Pick start date"
                                            />

                                            <div className="text-[11px] text-slate-500 self-center">
                                                {rangeStartISO} → {dateISO}
                                            </div>
                                        </div>

                                        {/* Rating Pills: Hub view only */}
                                        {feedbackView === "HUB" && (
                                            <div className="mt-3 grid grid-cols-3 gap-2">
                                                {[5, 4, 3, 2, 1].map((r) => (
                                                    <button
                                                        key={r}
                                                        type="button"
                                                        onClick={() => setFocusRating(r)}
                                                        className={cx(
                                                            "rounded-xl border px-2 py-2 text-xs font-semibold",
                                                            focusRating === r ? "border-slate-900 bg-slate-50" : "bg-white hover:bg-slate-50"
                                                        )}
                                                    >
                                                        {r}★ ({ratingCounts[String(r)] ?? 0})
                                                    </button>
                                                ))}
                                                <button
                                                    type="button"
                                                    onClick={() => setFocusRating("NF")}
                                                    className={cx(
                                                        "rounded-xl border px-2 py-2 text-xs font-semibold",
                                                        focusRating === "NF" ? "border-slate-900 bg-slate-50" : "bg-white hover:bg-slate-50"
                                                    )}
                                                >
                                                    NF ({ratingCounts.NF ?? 0})
                                                </button>
                                            </div>
                                        )}

                                        {/* Feedback Content */}
                                        {feedbackView === "HUB" ? (
                                            <div className="mt-3 space-y-2 max-h-[520px] overflow-y-auto pr-1">
                                                {visibleFeedback
                                                    .slice()
                                                    .sort((a, b) => (b.dateISO + b.time).localeCompare(a.dateISO + a.time))
                                                    .slice(0, 3)
                                                    .map((v) => (
                                                        <div key={v.id} className="rounded-xl border bg-white p-3">
                                                            <div className="flex items-start justify-between gap-2">
                                                                <div className="min-w-0">
                                                                    <p className="text-sm font-semibold truncate">Lead {v.leadId}</p>
                                                                    <p className="text-xs text-slate-600 truncate">
                                                                        {v.customer}
                                                                        {v.rm ? (
                                                                            <> · RM {v.rm}</>
                                                                        ) : (
                                                                            <> · <span className="text-slate-500">RM Pending</span></>
                                                                        )}
                                                                    </p>
                                                                </div>
                                                                <div className="shrink-0 text-right text-sm">
                                                                    {typeof v.feedbackRating === "number" ? (
                                                                        <span className="inline-flex items-center gap-1 font-semibold">
                                                                            {v.feedbackRating} <Star className="h-4 w-4" />
                                                                        </span>
                                                                    ) : (
                                                                        <span className="font-semibold text-slate-500">NF</span>
                                                                    )}
                                                                </div>
                                                            </div>

                                                            {v.feedbackText ? (
                                                                <p className="mt-2 text-xs text-slate-700">“{v.feedbackText}”</p>
                                                            ) : (
                                                                <p className="mt-2 text-xs text-slate-500">No feedback text</p>
                                                            )}
                                                        </div>
                                                    ))}

                                                {!visibleFeedback.length && (
                                                    <div className="text-xs text-slate-500">No feedback in this view.</div>
                                                )}
                                            </div>
                                        ) : (
                                            <div className="mt-3 overflow-x-auto">
                                                <table className="w-full text-xs border rounded-xl overflow-hidden">
                                                    <thead className="bg-slate-100 text-slate-700">
                                                        <tr>
                                                            <th className="text-left px-3 py-2 font-semibold">RM Name</th>
                                                            <th className="text-center px-3 py-2 font-semibold">&lt; 3</th>
                                                            <th className="text-center px-3 py-2 font-semibold">≥ 3</th>
                                                            <th className="text-center px-3 py-2 font-semibold">NF</th>
                                                            <th className="text-center px-3 py-2 font-semibold">Total</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {rmAggregated.map((rm) => (
                                                            <tr key={rm.rm} className="border-t">
                                                                <td className="px-3 py-2 font-semibold text-slate-800">{rm.rm}</td>
                                                                <td className="px-3 py-2 text-center text-red-600 font-semibold">{rm.below3}</td>
                                                                <td className="px-3 py-2 text-center text-green-600 font-semibold">{rm.aboveEq3}</td>
                                                                <td className="px-3 py-2 text-center text-slate-600 font-semibold">{rm.nf}</td>
                                                                <td className="px-3 py-2 text-center font-bold">{rm.total}</td>
                                                            </tr>
                                                        ))}
                                                        {!rmAggregated.length && (
                                                            <tr>
                                                                <td colSpan="5" className="px-3 py-4 text-center text-slate-500">
                                                                    No RM feedback data.
                                                                </td>
                                                            </tr>
                                                        )}
                                                    </tbody>
                                                </table>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </CardContent>
                        </Card>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<HubSummaryDesignerRevamp />);
    </script>
</body>

</html>